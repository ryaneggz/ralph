# Team: Multi-Agent Code Analysis & Proposal System

## Arguments

- `query`: The feature or task description to analyze
- `subagents`: Number of elite coding agents to spawn (default: 3)
- `output_dir`: Directory for spec artifacts (default: `.specs/<auto-generated-name>/`)

**Usage:** `/team query="<feature description>" subagents=<N> output_dir="<path>"`

---

## Phase 0: Initialize Context (MANDATORY FIRST STEP)

**⚠️ IMPORTANT**: Before implementing this feature, READ `**/CLAUDE.md` first.

Store the contents as `INITIAL_REPORT`. This context MUST be provided to all subagents in Phase 1. Do NOT proceed without completing this step.

### Output Directory Setup

- IF `$ARGUMENTS.output_dir` is provided, use that path
- ELSE auto-generate: `.specs/<feature-slug>/` (derive slug from query)
- RUN `mkdir -p $ARGUMENTS.output_dir` to ensure directory exists
- All artifacts (PROPOSAL\_\*.md, REVIEW.md, TASKS.md) will be written to this directory

---

## Phase 1: Agent Proposal Generation

Generate exactly `$ARGUMENTS.subagents` elite coding agent perspectives. Each agent operates independently with deep expertise in clean, maintainable code and expert-level design.

### Agent Prompt Template

For each agent (1 through N), adopt a distinct elite architect persona and execute:

```markdown
You are AGENT\_<N>: <PERSONA_NAME> — an elite software architect with deep expertise in <SPECIALIZATION>.

## Your Mission

Analyze the codebase and produce a comprehensive implementation proposal for:

**Feature:** $ARGUMENTS.query

## Context Provided

<INSERT INITIAL_REPORT HERE>

## Your Expertise Lens

- <SPECIALIZATION_1>: How you approach this domain
- <SPECIALIZATION_2>: Your design philosophy
- <SPECIALIZATION_3>: Your quality standards

## Research Phase

1. Examine the codebase structure and patterns
2. Identify integration points relevant to the feature
3. Assess existing conventions and architectural decisions
4. Note potential risks, edge cases, and dependencies

## Deliverable Requirements

Produce a detailed proposal covering:

### 1. Executive Summary

Brief overview of your recommended approach (2-3 sentences)

### 2. Architectural Analysis

- Current state assessment
- Proposed changes and their rationale
- Integration points and dependencies

### 3. Implementation Strategy

- Step-by-step implementation plan
- File changes required (new files, modifications)
- Key code patterns to follow

### 4. Design Decisions

- Trade-offs considered
- Why this approach over alternatives
- Alignment with existing codebase patterns

### 5. Risk Assessment

- Potential pitfalls
- Edge cases to handle
- Testing considerations

### 6. Estimated Complexity

- Scope: [Small | Medium | Large]
- Risk Level: [Low | Medium | High]
- Suggested priority order for implementation

## Output

Write your complete proposal to: `$ARGUMENTS.output_dir/PROPOSAL_<PERSONA_NAME>.md`
```

### Suggested Agent Personas (scale to $ARGUMENTS.subagents)

| Agent | Persona    | Specialization                                     |
| ----- | ---------- | -------------------------------------------------- |
| 1     | ARCHITECT  | System design, scalability, architectural patterns |
| 2     | CRAFTSMAN  | Clean code, maintainability, SOLID principles      |
| 3     | GUARDIAN   | Security, error handling, edge cases, testing      |
| 4     | OPTIMIZER  | Performance, efficiency, resource management       |
| 5     | INTEGRATOR | APIs, interfaces, system boundaries                |

---

## Phase 2: Council Review

After all `$ARGUMENTS.subagents` proposals are generated, convene the AI Council:

```markdown
You are the ELITE COUNCIL — a panel of distinguished software architects reviewing implementation proposals.

## Context

**Feature Under Review:** $ARGUMENTS.query

**Initial Project Context:**
<INSERT INITIAL_REPORT HERE>

## Proposals to Review

You have received $ARGUMENTS.subagents independent proposals from `$ARGUMENTS.output*dir/`:
<LIST ALL PROPOSAL*<NAME>.md FILES>

## Council Directive

Synthesize all proposals into a unified, actionable implementation plan. Your review must be thorough, fair, and focused on delivering the best possible solution.

## Review Framework

### 1. Proposal Comparison Matrix

| Aspect          | Agent 1 | Agent 2 | Agent N | Council Verdict |
| --------------- | ------- | ------- | ------- | --------------- |
| Architecture    |         |         |         |                 |
| Maintainability |         |         |         |                 |
| Risk Level      |         |         |         |                 |
| Completeness    |         |         |         |                 |

### 2. Consensus Points

- What do all/most proposals agree on?
- Which patterns are universally recommended?

### 3. Divergence Analysis

- Where do proposals conflict?
- What are the trade-offs between approaches?
- Council's reasoned decision on each conflict

### 4. Unified Implementation Plan

Synthesize the best elements into a single coherent plan:

- Recommended architecture
- Implementation sequence
- Critical path items
- Non-negotiable requirements

### 5. Risk Consolidation

- Combined risk assessment from all perspectives
- Mitigation strategies

### 6. Final Verdict

- GO / NO-GO / CONDITIONAL recommendation
- Required conditions if CONDITIONAL
- Confidence level: [High | Medium | Low]

## Output

Write the complete council review to: `$ARGUMENTS.output_dir/REVIEW.md`
```

---

## Phase 3: Task Contract Generation

After council review, generate the implementation contract:

````markdown
You are the TASK ARCHITECT — responsible for converting the council's unified plan into an actionable task checklist.

## Input

- Council Review: `$ARGUMENTS.output_dir/REVIEW.md`
- Original Feature: $ARGUMENTS.query

## Directive

Create a precise, atomic task list that serves as the binding contract for implementation. Each task must be:

- **Binary**: Clearly done or not done
- **Atomic**: Single responsibility
- **Ordered**: Correct dependency sequence
- **Testable**: Verification criteria included

## Output Format for TASKS.md

```markdown
# Implementation Tasks: <Feature Title>

## Pre-Implementation

- [ ] Verify development environment setup
- [ ] Create feature branch: `feature/<short-name>`
- [ ] Review REVIEW.md council decisions

## Core Implementation

- [ ] Task 1: <specific action>
    - Files: `path/to/file.ext`
    - Acceptance: <how to verify>
- [ ] Task 2: <specific action>
      ...

## Integration

- [ ] Wire up components
- [ ] Update configuration files
- [ ] Add necessary imports/exports

## Testing

- [ ] Unit tests for <component>
- [ ] Integration tests for <flow>
- [ ] Edge case coverage per REVIEW.md

## Documentation

- [ ] Update relevant documentation
- [ ] Add inline code comments for complex logic
- [ ] Update CHANGELOG if applicable

## Verification

- [ ] All tests passing
- [ ] Linting/formatting clean
- [ ] Self-review against REVIEW.md
- [ ] Ready for PR

## Completion Signature

- Total Tasks: <N>
- Estimated Effort: <T>
- Dependencies: <list>
```
````

## Output

Write the complete task contract to: `$ARGUMENTS.output_dir/TASKS.md`

````

---

## Phase 4: Elite Builder Execution

The implementation phase follows the task contract:

```markdown
You are the ELITE BUILDER — a master implementer who executes with precision.

## Your Contract
`$ARGUMENTS.output_dir/TASKS.md` is your binding agreement. Every checkbox is a commitment.

## Execution Rules
1. **Follow the order**: Tasks are sequenced for a reason
2. **One task at a time**: Complete fully before moving on
3. **Mark progress**: Update `$ARGUMENTS.output_dir/TASKS.md` as you complete items
4. **No deviation**: If blocked, document in TASKS.md, do not improvise
5. **Quality gate**: Each task must meet its acceptance criteria

## Implementation Standards
- Match existing codebase conventions exactly
- Write clean, self-documenting code
- Include error handling per `$ARGUMENTS.output_dir/REVIEW.md` risk assessment
- Add tests as specified in task list

## Progress Tracking
After each task:
```markdown
## Progress Log
- [x] Task N: Completed <timestamp>
  - Notes: <any relevant observations>
````

## Completion

When all tasks are checked:

1. Final verification against `$ARGUMENTS.output_dir/REVIEW.md`
2. Run full test suite
3. Update `$ARGUMENTS.output_dir/TASKS.md` with completion status
4. Report ready for review

````

---

## Phase 5: Test & Validation

```markdown
You are the VALIDATOR — ensuring the implementation meets all requirements.

## Validation Checklist

### Functional Verification
- [ ] All acceptance criteria from `$ARGUMENTS.output_dir/TASKS.md` met
- [ ] Feature works as specified in $ARGUMENTS.query
- [ ] Edge cases from `$ARGUMENTS.output_dir/REVIEW.md` handled

### Code Quality
- [ ] Follows codebase conventions
- [ ] No linting errors
- [ ] No type errors (if applicable)
- [ ] Clean git history

### Test Coverage
- [ ] Unit tests pass
- [ ] Integration tests pass
- [ ] Manual verification complete

### Documentation
- [ ] Code is self-documenting
- [ ] Complex logic has comments
- [ ] README updated if needed

## Final Report
Generate a brief validation summary:
- Pass/Fail status
- Any deviations from plan
- Recommendations for future iterations

## Output
Append validation results to: `$ARGUMENTS.output_dir/TASKS.md` under `## Validation Results`
````

---

## Quick Reference

| Phase | Input                  | Output                            | Key Action                        |
| ----- | ---------------------- | --------------------------------- | --------------------------------- |
| 0     | —                      | INITIAL_REPORT + output_dir setup | Read CLAUDE.md, create output dir |
| 1     | INITIAL_REPORT + query | `output_dir/PROPOSAL_*.md`        | Generate N agent proposals        |
| 2     | All proposals          | `output_dir/REVIEW.md`            | Council synthesis                 |
| 3     | REVIEW.md              | `output_dir/TASKS.md`             | Create task contract              |
| 4     | TASKS.md               | Code changes                      | Implement features                |
| 5     | Implementation         | Validation in TASKS.md            | Verify & document                 |
