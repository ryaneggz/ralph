## Codebase Patterns
- Next.js 14+ App Router with src/ directory and @/* import alias
- shadcn/ui initialized with Tailwind v4, CSS variables
- MongoDB connection uses global cache singleton pattern in src/lib/db.ts
- Type definitions live in src/lib/types/
- Auth config in src/lib/auth.ts using next-auth
- User model in src/lib/models/user.ts (Mongoose)
- NextAuth v5 beta uses `next-auth/providers/credentials` and `next-auth/providers/github` imports
- Signup is a custom API route at /api/auth/signup (not part of NextAuth)
- Auth pages use route group `(auth)` with login/ and signup/ directories
- shadcn/ui components added via `npx shadcn@latest add <component>`
- SessionProvider wrapper lives in src/components/session-provider.tsx (client component)
- UserMenu component uses useSession() from next-auth/react for client-side session access
- Root layout wraps children with AuthSessionProvider for client-side session access
- AppShell component provides shared layout (header + sidebar + main content area)
- Sidebar fetches projects from /api/projects on each pathname change
- Project model in src/lib/models/project.ts (Mongoose)
- Projects API at /api/projects (GET list, POST create)
- Middleware matcher must include /projects/:path* for auth protection
- Project settings page at /projects/[id]/settings — server component with client form components
- API routes for project sub-resources follow /api/projects/[id]/{resource} pattern
- Never return secrets from API — use boolean flags (e.g., hasAccessToken) or maskedValue
- AES-256-GCM encryption via src/lib/crypto.ts — uses ENCRYPTION_KEY env var, SHA-256 derived key
- AuditLog model in src/lib/models/audit-log.ts — logAudit() is fire-and-forget (non-blocking)
- Env vars stored with maskedValue in DB to avoid decrypting for display
- API sub-resources: /api/projects/[id]/env-vars for env var CRUD
- API sub-resources: /api/projects/[id]/provider-keys for provider key CRUD (PUT to add/replace, DELETE to remove)
- Run model in src/lib/models/run.ts — separate collection from Project, queried by projectId+userId
- Runs API at /api/projects/[id]/runs (GET list, POST create)
- IaC templates defined in src/lib/iac-templates.ts — IAC_TEMPLATE_IDS for validation, IAC_TEMPLATES for display
- ProviderKeyForm component is reusable for all providers (claude-code, codeex, opencode)
- Project-level mutations (rename, delete, config) use /api/projects/[id] route with PATCH/DELETE methods
- AWS regions list shared via src/lib/aws-regions.ts — use for any AWS region dropdowns/validation
---

## 2026-01-28 - US-01
- Implemented sign up and sign in with email/password credentials and GitHub OAuth
- Configured NextAuth.js with JWT sessions (7-day expiry), credentials + GitHub providers
- Created User Mongoose model with email, password (bcrypt hashed), name, emailVerified fields
- Built login page with email/password form and GitHub OAuth button
- Built signup page with name/email/password form and GitHub OAuth button
- Created /api/auth/signup POST route with validation and bcrypt hashing
- Created /api/auth/[...nextauth] route handler
- Added middleware for protected routes
- Updated home page to redirect based on auth state
- Files changed:
  - src/lib/auth.ts (NextAuth config)
  - src/lib/models/user.ts (new)
  - src/app/api/auth/[...nextauth]/route.ts (new)
  - src/app/api/auth/signup/route.ts (new)
  - src/app/(auth)/login/page.tsx (new)
  - src/app/(auth)/signup/page.tsx (new)
  - src/middleware.ts (new)
  - src/app/page.tsx (updated to redirect)
  - src/components/ui/ (button, input, label, card, separator via shadcn)
- **Learnings for future iterations:**
  - NextAuth v5 beta exports `auth` which can be used directly as middleware export
  - GitHub OAuth auto-creates users in the signIn callback (no adapter needed for basic flow)
  - Email verification is a TODO - placeholder noted in signup route
  - bcryptjs used instead of bcrypt for easier cross-platform install
---

## 2026-01-28 - US-02
- Implemented sign out via user menu dropdown
- Created UserMenu client component with avatar, dropdown, and sign out action
- Created AuthSessionProvider wrapper for next-auth/react SessionProvider
- Wrapped root layout with AuthSessionProvider
- Created /inbox page as authenticated landing page with header and UserMenu
- Added shadcn dropdown-menu and avatar components
- Files changed:
  - src/components/user-menu.tsx (new)
  - src/components/session-provider.tsx (new)
  - src/app/layout.tsx (updated - added SessionProvider wrapper, updated metadata)
  - src/app/inbox/page.tsx (new)
  - src/components/ui/dropdown-menu.tsx (new - shadcn)
  - src/components/ui/avatar.tsx (new - shadcn)
- **Learnings for future iterations:**
  - next-auth/react `signOut({ callbackUrl: "/login" })` handles JWT invalidation and redirect
  - `useSession()` requires SessionProvider ancestor - wrapped in root layout
  - UserMenu is a client component; inbox page is a server component that renders it
---

## 2026-01-28 - US-04
- Implemented project creation with sidebar, dialog form, API, and workspace page
- Created Project Mongoose model with userId, name, description, repoUrl fields
- Created /api/projects route with POST (create) and GET (list by user)
- Built Sidebar component with project list and "New Project" button
- Built NewProjectDialog with name (required), description (optional), repoUrl (optional)
- Created AppShell component (header + sidebar + main content)
- Created /projects/[id] workspace page showing project details
- Updated inbox page to use AppShell layout
- Updated middleware matcher to protect /projects routes
- Added shadcn dialog and textarea components
- Files changed:
  - src/lib/models/project.ts (new)
  - src/app/api/projects/route.ts (new)
  - src/components/sidebar.tsx (new)
  - src/components/new-project-dialog.tsx (new)
  - src/components/app-shell.tsx (new)
  - src/app/projects/[id]/page.tsx (new)
  - src/app/inbox/page.tsx (updated - uses AppShell)
  - src/middleware.ts (updated - added /projects matcher)
  - src/components/ui/dialog.tsx (new - shadcn)
  - src/components/ui/textarea.tsx (new - shadcn)
- **Learnings for future iterations:**
  - AppShell wraps authenticated pages with header + sidebar layout
  - Sidebar re-fetches project list on pathname change (useEffect dep on pathname)
  - Next.js 15 params are Promises — must await them in page components
  - Project pages check userId ownership before rendering
---

## 2026-01-29 - US-04a
- Implemented repository configuration for projects
- Added `repo` subdocument (url, branch, accessTokenArn) to Project Mongoose model
- Created PUT/GET API at /api/projects/[id]/repo with HTTPS Git URL validation
- Built RepoConfigForm client component with URL, branch, access token fields
- Created project settings page at /projects/[id]/settings with repo config section
- Added settings link to project workspace page
- Test Clone button validates URL format (full clone test deferred to backend infra)
- Files changed:
  - src/lib/models/project.ts (updated - added repo subdocument schema)
  - src/app/api/projects/[id]/repo/route.ts (new)
  - src/components/repo-config-form.tsx (new)
  - src/app/projects/[id]/settings/page.tsx (new)
  - src/app/projects/[id]/page.tsx (updated - added settings link)
  - prd.json (updated - US-04a passes: true)
- **Learnings for future iterations:**
  - Mongoose subdocuments use `{ _id: false }` to avoid auto-generated _id
  - API never returns raw access tokens — only `hasAccessToken` boolean
  - Project settings page is at /projects/[id]/settings (server component renders client form)
  - HTTPS Git URL regex: `/^https:\/\/.+\.git$/`
  - Full clone test requires backend infrastructure (Lambda or similar) — stubbed for now
---

## 2026-01-29 - US-04b
- Implemented agent environment variables configuration for projects
- Added IEnvVar interface and EnvVarSchema to Project model (key, valueArn, source, maskedValue)
- Created /api/projects/[id]/env-vars route with GET, PUT, DELETE methods
- Built EnvVarsConfigForm client component with add/edit/delete key-value pairs
- Added merged env vars preview with masked values and source badges (platform/user)
- Integrated env vars section into project settings page
- Files changed:
  - src/lib/models/project.ts (updated - added IEnvVar, EnvVarSchema, envVars field)
  - src/app/api/projects/[id]/env-vars/route.ts (new)
  - src/components/env-vars-config-form.tsx (new)
  - src/app/projects/[id]/settings/page.tsx (updated - added env vars section)
  - prd.json (updated - US-04b passes: true)
- **Learnings for future iterations:**
  - Env var keys validated with regex `^[A-Za-z_][A-Za-z0-9_]*$`
  - maskedValue stored in DB to avoid decrypting secrets just to display them
  - API never returns actual secret values — only masked versions
  - Source field distinguishes "platform" (auto-injected provider keys) from "user" (custom)
  - AWS Secrets Manager integration is stubbed with `pending-encryption` placeholder ARN
---

## 2026-01-29 - US-05
- Implemented project rename via settings page
- Created PATCH /api/projects/[id] endpoint with name validation (non-empty, max 100 chars)
- Created ProjectRenameForm client component with inline validation, success/error feedback
- Added "Project Name" section to project settings page (above repo config)
- router.refresh() updates sidebar and header after rename
- Files changed:
  - src/app/api/projects/[id]/route.ts (new)
  - src/components/project-rename-form.tsx (new)
  - src/app/projects/[id]/settings/page.tsx (updated - added rename section)
  - prd.json (updated - US-05 passes: true)
- **Learnings for future iterations:**
  - Project-level API routes go at /api/projects/[id]/route.ts (PATCH, DELETE, etc.)
  - router.refresh() from next/navigation re-fetches server components, updating sidebar project names
  - Settings page sections order: Project Name > Repository > Env Vars > Danger Zone (delete)
---

## 2026-01-29 - US-06
- Implemented project deletion with confirmation dialog requiring project name typed to confirm
- Added DELETE method to /api/projects/[id] route (findOneAndDelete with userId check)
- Created ProjectDeleteSection client component with two-step confirmation (button → type name → delete)
- Added "Danger Zone" section at bottom of project settings page with destructive styling
- Redirects to /inbox after successful deletion, router.refresh() updates sidebar
- Files changed:
  - src/app/api/projects/[id]/route.ts (updated - added DELETE handler)
  - src/components/project-delete-section.tsx (new)
  - src/app/projects/[id]/settings/page.tsx (updated - added danger zone section)
  - prd.json (updated - US-06 passes: true)
- **Learnings for future iterations:**
  - Danger zone pattern: separate section at bottom with destructive border, requires typing entity name to confirm
  - DELETE endpoint uses findOneAndDelete with userId ownership check
  - Cascade delete for runs/drafts/IaC is handled at DB level when those models exist (currently only project doc)
---

## 2026-01-29 - US-07
- Implemented project switcher dropdown in sidebar (appears when >1 project exists)
- Added localStorage persistence for last-used project ID (key: ralph-last-project-id)
- Created LastProjectRedirect client component that auto-redirects from /inbox to last-used project
- Sidebar saves current project ID to localStorage on navigation
- Files changed:
  - src/components/sidebar.tsx (updated - added switcher dropdown, localStorage helpers, exported getLastProjectId/setLastProjectId)
  - src/components/last-project-redirect.tsx (new - client component for auto-redirect)
  - src/app/inbox/page.tsx (updated - added LastProjectRedirect component)
  - prd.json (updated - US-07 passes: true)
- **Learnings for future iterations:**
  - localStorage helpers (getLastProjectId, setLastProjectId) exported from sidebar.tsx for reuse
  - Project switcher only renders when projects.length > 1 (no switcher for single project)
  - LastProjectRedirect uses router.replace() to avoid adding /inbox to history stack
  - extractProjectId() regex extracts project ID from any /projects/[id]/* pathname
---

## 2026-01-29 - US-08
- Implemented Claude Code API key configuration on project settings page
- Added IProviderKey interface and ProviderKeySchema to Project model (provider, keyArn, maskedValue)
- Created /api/projects/[id]/provider-keys route with GET, PUT, DELETE methods
- Built ProviderKeyForm client component with save, replace, and test-connection functionality
- Added "Provider API Keys" section to project settings page (between Repository and Env Vars)
- Test button validates Claude Code key format (sk-ant- prefix); full API validation deferred to backend
- Files changed:
  - src/lib/models/project.ts (updated - added IProviderKey, ProviderKeySchema, providerKeys field)
  - src/app/api/projects/[id]/provider-keys/route.ts (new)
  - src/components/provider-key-form.tsx (new)
  - src/app/projects/[id]/settings/page.tsx (updated - added Provider API Keys section)
  - prd.json (updated - US-08 passes: true)
- **Learnings for future iterations:**
  - Provider keys follow same pattern as env vars: masked values stored in DB, never return actual keys
  - VALID_PROVIDERS constant defines allowed providers: claude-code, codeex, opencode
  - ProviderKeyForm is reusable for all providers — just change provider/label/placeholder props
  - Settings page section order: Project Name > Repository > Provider API Keys > Env Vars > Danger Zone
---


## 2026-01-29 - US-09
- Added Codeex provider key form to project settings page
- Added Codeex-specific key format validation (codeex- prefix) in ProviderKeyForm
- Files changed:
  - src/app/projects/[id]/settings/page.tsx (updated - added Codeex ProviderKeyForm)
  - src/components/provider-key-form.tsx (updated - added codeex format validation)
  - prd.json (updated - US-09 passes: true)
- **Learnings for future iterations:**
  - Adding a new provider key is trivial: add another ProviderKeyForm instance in settings page + add format validation in provider-key-form.tsx
  - Provider key prefix conventions: claude-code → sk-ant-, codeex → codeex-, opencode → opencode-
---

## 2026-01-29 - US-10
- Added OpenCode provider key form to project settings page
- Added OpenCode-specific key format validation (opencode- prefix) in ProviderKeyForm
- Files changed:
  - src/app/projects/[id]/settings/page.tsx (updated - added OpenCode ProviderKeyForm)
  - src/components/provider-key-form.tsx (updated - added opencode format validation)
  - prd.json (updated - US-10 passes: true)
- **Learnings for future iterations:**
  - Identical pattern to US-09: add ProviderKeyForm instance + format validation
  - All three providers now configured: claude-code, codeex, opencode
---

## 2026-01-29 - US-11
- Added provider configuration status summary to project workspace page
- Shows all three providers with Configured/Not Configured badges and masked key values
- Links to settings page for key management
- Existing ProviderKeyForm already had status badges and masked display; this adds a read-only overview on the workspace
- Files changed:
  - src/app/projects/[id]/page.tsx (updated - added Provider Status section)
  - prd.json (updated - US-11 passes: true)
- **Learnings for future iterations:**
  - Provider status overview on workspace page complements the editable forms on settings page
  - project.providerKeys array can be accessed directly in server components without API call
---

## 2026-01-29 - US-12
- Added explicit "Rotate" button to ProviderKeyForm for configured providers
- When configured: shows Rotate + Test buttons; clicking Rotate reveals input field with "Rotate Key" save button and Cancel
- When not configured: shows input field with Save button (unchanged behavior)
- Rotation uses existing PUT endpoint which already supports replacing keys
- Files changed:
  - src/components/provider-key-form.tsx (updated - added rotating state, Rotate button UX)
  - prd.json (updated - US-12 passes: true)
- **Learnings for future iterations:**
  - Rotate is functionally identical to Replace — same PUT endpoint, just different UX flow
  - The rotating state hides the input until user explicitly clicks Rotate, reducing accidental overwrites
---

## 2026-01-29 - US-13
- Added Delete button with confirmation dialog to ProviderKeyForm component
- When configured: shows Delete button alongside Rotate and Test
- Clicking Delete shows inline confirmation with "Confirm Delete" and "Cancel" buttons
- On confirm: calls DELETE /api/projects/[id]/provider-keys endpoint (already existed)
- Provider status reverts to "Not Configured" after deletion
- Files changed:
  - src/components/provider-key-form.tsx (updated - added delete confirmation flow)
  - prd.json (updated - US-13 passes: true)
- **Learnings for future iterations:**
  - DELETE endpoint for provider keys already existed from US-08 implementation
  - Inline confirmation pattern (no modal) keeps the UX lightweight for single-action destructive operations
---

## 2026-01-29 - US-14
- Implemented AES-256-GCM encryption for secrets at rest via src/lib/crypto.ts
- Created AuditLog model with fire-and-forget logAudit() helper
- Updated provider-keys and env-vars API routes to encrypt values and log audit entries
- Added ENCRYPTION_KEY to .env.example
- All API responses already return only masked values (first 4 + last 4 chars) — verified no plaintext leaks
- Files changed:
  - src/lib/crypto.ts (new - AES-256-GCM encrypt/decrypt)
  - src/lib/models/audit-log.ts (new - AuditLog model + logAudit helper)
  - src/app/api/projects/[id]/provider-keys/route.ts (updated - encryption + audit logging)
  - src/app/api/projects/[id]/env-vars/route.ts (updated - encryption + audit logging)
  - ralph-orchestrator/.env.example (updated - added ENCRYPTION_KEY)
  - prd.json (updated - US-14 passes: true)
- **Learnings for future iterations:**
  - crypto.ts uses SHA-256 to derive 32-byte key from ENCRYPTION_KEY env var
  - Encrypted format is "iv:authTag:ciphertext" (base64 encoded parts)
  - isEncryptionConfigured() gracefully falls back to "pending-encryption" if no key set
  - AuditLog uses fire-and-forget pattern — logAudit() returns void, errors logged to console
  - Audit entries track: read, create, rotate, update, delete actions on provider-keys and env-vars
---

## 2026-01-29 - US-15
- Implemented AWS region configuration per project
- Added `awsRegion` field to Project model (default: us-east-1)
- Created shared `src/lib/aws-regions.ts` with all AWS regions and human-readable labels
- Extended PATCH /api/projects/[id] to accept `awsRegion` field with validation
- Created AwsRegionForm client component with dropdown of all AWS regions
- Added "AWS Configuration" section to project settings page (between Env Vars and Danger Zone)
- Files changed:
  - src/lib/models/project.ts (updated - added awsRegion field)
  - src/lib/aws-regions.ts (new - AWS_REGIONS constant and labels)
  - src/app/api/projects/[id]/route.ts (updated - PATCH accepts awsRegion)
  - src/components/aws-region-form.tsx (new - region dropdown form)
  - src/app/projects/[id]/settings/page.tsx (updated - added AWS Configuration section)
  - prd.json (updated - US-15 passes: true)
- **Learnings for future iterations:**
  - PATCH /api/projects/[id] now handles multiple fields (name, awsRegion) — extend update object for new project-level fields
  - AWS_REGIONS is a `const` array — use `(AWS_REGIONS as readonly string[]).includes()` for runtime string validation
  - Settings page section order: Project Name > Repository > Provider API Keys > Env Vars > AWS Configuration > AWS Authentication > Danger Zone
---

## 2026-01-29 - US-16
- Implemented AWS authentication configuration with choice of IAM Role ARN or Access Key pair
- Added IAwsAuth interface and AwsAuthSchema to Project model (authType, roleArn, accessKeyId, secretAccessKeyArn, maskedSecretKey)
- Created /api/projects/[id]/aws-auth route with GET, PUT, DELETE methods
- Built AwsAuthForm client component with radio buttons for auth type selection
- IAM Role ARN validated with regex for proper ARN format
- Access key secrets encrypted via AES-256-GCM and stored with masked values
- Added "AWS Authentication" section to project settings page (after AWS Configuration)
- Least-privilege IAM role template link provided
- Files changed:
  - src/lib/models/project.ts (updated - added IAwsAuth, AwsAuthSchema, awsAuth field)
  - src/app/api/projects/[id]/aws-auth/route.ts (new)
  - src/components/aws-auth-form.tsx (new)
  - src/app/projects/[id]/settings/page.tsx (updated - added AWS Authentication section)
  - prd.json (updated - US-16 passes: true)
- **Learnings for future iterations:**
  - AWS auth uses subdocument pattern like repo config — $unset to remove on DELETE
  - IAM Role ARN regex: `/^arn:aws:iam::\d{12}:role\/[\w+=,.@-]+$/`
  - Secret access keys encrypted same way as provider keys and env vars (AES-256-GCM)
  - Radio buttons for mutually exclusive auth type selection (role vs access-keys)
---

## 2026-01-29 - US-17
- Implemented AWS connectivity test via STS GetCallerIdentity
- Created POST /api/projects/[id]/aws-auth/test endpoint
- For access-keys: decrypts stored secret, creates STS client with credentials, calls GetCallerIdentity
- For role: assumes role via AssumeRole, then calls GetCallerIdentity with assumed credentials
- Added "Test Connection" button to AwsAuthForm with loading state
- Shows AWS Account ID on success, error message on failure
- Installed @aws-sdk/client-sts package
- Files changed:
  - src/app/api/projects/[id]/aws-auth/test/route.ts (new)
  - src/components/aws-auth-form.tsx (updated - added Test Connection button)
  - ralph-orchestrator/package.json (updated - added @aws-sdk/client-sts)
  - prd.json (updated - US-17 passes: true)
- **Learnings for future iterations:**
  - @aws-sdk/client-sts is the AWS SDK v3 package for STS operations
  - For role-based auth, need AssumeRole first then use temporary credentials for GetCallerIdentity
  - decrypt() from crypto.ts recovers the stored secret access key for runtime use
  - Test endpoint is a separate route at /aws-auth/test to keep concerns separated from CRUD
---

## 2026-01-29 - US-18
- Implemented AWS credential update flow with edit/read-only toggle
- When configured: shows read-only summary with masked values, Edit/Test/Remove buttons
- Clicking Edit reveals editable form pre-filled with current values (masked secret)
- On update: saves credentials then auto-runs test connection for validation
- Cancel button returns to read-only view without saving
- Running agents unaffected — note shown that new credentials apply on next iteration
- Files changed:
  - src/components/aws-auth-form.tsx (updated - added editing state, read-only summary view, validation on update)
  - prd.json (updated - US-18 passes: true)
- **Learnings for future iterations:**
  - Edit toggle pattern: `editing` state starts false when configured, true when not
  - Post-save validation: save first, then test connection, report combined result
  - Cancel edit resets to read-only without API call
---

## 2026-01-29 - US-19
- Implemented IaC template selector with three options: Fargate, Lambda, EC2 Spot
- Created src/lib/iac-templates.ts with template data (id, name, description, estimated cost range)
- Added iacTemplate field to Project model
- Extended PATCH /api/projects/[id] to accept and validate iacTemplate
- Created IacTemplateSelector client component with card-style radio selection
- Added "IaC Template" section to project settings page (between AWS Authentication and Danger Zone)
- Files changed:
  - src/lib/iac-templates.ts (new - IaC template definitions)
  - src/lib/models/project.ts (updated - added iacTemplate field)
  - src/app/api/projects/[id]/route.ts (updated - PATCH accepts iacTemplate)
  - src/components/iac-template-selector.tsx (new - template selector component)
  - src/app/projects/[id]/settings/page.tsx (updated - added IaC Template section)
  - prd.json (updated - US-19 passes: true)
- **Learnings for future iterations:**
  - IaC templates defined in src/lib/iac-templates.ts — add new templates there
  - IAC_TEMPLATE_IDS exported for runtime validation in API routes
  - Settings page section order: Project Name > Repository > Provider API Keys > Env Vars > AWS Configuration > AWS Authentication > IaC Template > Danger Zone
---

## 2026-01-29 - US-20
- Implemented IaC file generation from selected Pulumi templates (Fargate, Lambda, EC2 Spot)
- Added IIacFile interface and iacFiles field to Project model
- Created src/lib/iac-generators.ts with template-specific Pulumi TypeScript generators
- Created POST /api/projects/[id]/iac-generate endpoint that generates and stores files
- Built IacGenerateSection client component with Generate button and tabbed file viewer
- Added Infrastructure as Code section to project workspace page
- Files changed:
  - src/lib/models/project.ts (updated - added IIacFile interface, iacFiles field)
  - src/lib/iac-generators.ts (new - Pulumi template generators per template type)
  - src/app/api/projects/[id]/iac-generate/route.ts (new - POST endpoint)
  - src/components/iac-generate-section.tsx (new - generate button + file viewer)
  - src/app/projects/[id]/page.tsx (updated - added IaC section)
  - prd.json (updated - US-20 passes: true)
- **Learnings for future iterations:**
  - IaC generators live in src/lib/iac-generators.ts — add new templates there with a generator function
  - iacFiles stored as array of {path, content} objects directly in the Project document
  - Generate endpoint is POST /api/projects/[id]/iac-generate — overwrites previous files on regenerate
  - IacGenerateSection component shows tabbed file viewer with syntax-highlighted code
  - Template generators receive projectName and awsRegion as options
---

## 2026-01-29 - US-21
- Replaced plain `<pre>` code viewer with Monaco editor in read-only mode
- Added file tree sidebar for multi-file navigation (replaces tab strip)
- Monaco editor provides TypeScript syntax highlighting, line numbers, word wrap
- Language auto-detected from file extension (.ts, .js, .json, .yaml)
- Files changed:
  - src/components/iac-generate-section.tsx (updated - Monaco editor + file tree sidebar)
  - ralph-orchestrator/package.json (updated - added @monaco-editor/react)
  - prd.json (updated - US-21 passes: true)
- **Learnings for future iterations:**
  - @monaco-editor/react is the React wrapper for Monaco; import as `Editor` from `@monaco-editor/react`
  - Use `readOnly: true` and `domReadOnly: true` options together for truly read-only Monaco
  - Monaco needs explicit height (not auto); use container with fixed height
  - File tree sidebar pattern: left panel (w-48) + flex-1 editor area
---

## 2026-01-29 - US-22
- Implemented edit mode toggle for IaC files in Monaco editor
- Added Edit/Cancel Edit/Save buttons to IaC generate section toolbar
- Monaco editor switches between readOnly and editable modes
- TypeScript syntax validation via Monaco markers — blocks save if errors exist
- Created PUT /api/projects/[id]/iac-files endpoint for saving edited files
- Cancel edit reverts to original files (unsaved changes discarded)
- Files changed:
  - src/components/iac-generate-section.tsx (updated - edit mode, save, marker validation)
  - src/app/api/projects/[id]/iac-files/route.ts (new - PUT endpoint for saving)
  - prd.json (updated - US-22 passes: true)
- **Learnings for future iterations:**
  - Monaco `onMount` callback gives access to both editor instance and monaco namespace
  - Use `editor.IMarker` type from `monaco-editor` for marker type annotations
  - `monacoRef.current.editor.getModelMarkers()` returns all markers for validation
  - `OnMount` type imported from `@monaco-editor/react` for proper typing
  - Cancel edit should revert to `initialFiles` prop (server state), not last saved state
---

## 2026-01-29 - US-23
- Implemented IaC draft auto-save with 2s debounce and manual Save Draft button
- Added `iacDraftFiles` and `iacDraftUpdatedAt` fields to Project model
- Created /api/projects/[id]/iac-draft route with GET, PUT, DELETE methods
- Updated iac-files PUT route to clear draft on explicit save
- Added draft indicator badge (yellow) with timestamp in IaC editor toolbar
- Drafts load on page visit if present, persisting across sessions
- Auto-save triggers on every editor change with 2s debounce
- Files changed:
  - src/lib/models/project.ts (updated - added iacDraftFiles, iacDraftUpdatedAt)
  - src/app/api/projects/[id]/iac-draft/route.ts (new)
  - src/app/api/projects/[id]/iac-files/route.ts (updated - clears draft on save)
  - src/components/iac-generate-section.tsx (updated - auto-save, draft badge, Save Draft button)
  - src/app/projects/[id]/page.tsx (updated - passes draft props)
  - prd.json (updated - US-23 passes: true)
- **Learnings for future iterations:**
  - Draft files stored separately from iacFiles to distinguish draft vs applied state
  - Auto-save uses useRef for timer + filesRef to avoid stale closures in debounced callback
  - Explicit save (Save button) clears draft via $unset in the iac-files PUT route
  - Cancel edit reverts to initialFiles (applied), not draft files
  - Draft badge shows timestamp via toLocaleTimeString() for quick reference
---

## 2026-01-29 - US-24
- Implemented IaC version history with version list, inline diff view, and restore
- Added IIacVersion interface and iacVersions array to Project model
- Version entries created on generate (label: "generated"), save (label: "applied"), and restore
- Created GET /api/projects/[id]/iac-versions (list, newest first, without file contents)
- Created GET /api/projects/[id]/iac-versions/[versionId] (full version with file contents)
- Created POST /api/projects/[id]/iac-versions (restore a version by versionId)
- Built IacVersionHistory component with collapsible version list, radio-select diff, and restore button
- Inline diff uses LCS algorithm for line-by-line comparison with added/removed highlighting
- File selector dropdown for diffing multi-file versions
- IacVersionHistoryWrapper handles router.refresh() on restore
- Files changed:
  - src/lib/models/project.ts (updated - added IIacVersion, iacVersions field)
  - src/app/api/projects/[id]/iac-versions/route.ts (new - GET list, POST restore)
  - src/app/api/projects/[id]/iac-versions/[versionId]/route.ts (new - GET detail)
  - src/app/api/projects/[id]/iac-files/route.ts (updated - creates "applied" version on save)
  - src/app/api/projects/[id]/iac-generate/route.ts (updated - creates "generated" version on generate)
  - src/components/iac-version-history.tsx (new - version history UI)
  - src/components/iac-version-history-wrapper.tsx (new - client wrapper with router.refresh)
  - src/app/projects/[id]/page.tsx (updated - added version history component)
  - prd.json (updated - US-24 passes: true)
- **Learnings for future iterations:**
  - Version history stored as iacVersions array in Project document — each entry has versionId (UUID), label, files, createdAt
  - API list endpoint omits file contents for performance — use detail endpoint for full data
  - LCS-based diff works for reasonable file sizes; for very large files consider a streaming diff library
  - Restore creates a new "applied" version entry to maintain full audit trail
  - IacVersionHistoryWrapper pattern separates server-aware routing from pure UI component
---

## 2026-01-29 - US-25
- Implemented read-only PROMPT.md viewer with frontmatter metadata badges and Markdown rendering
- Added `promptMd` field to Project model (string, optional)
- Created GET /api/projects/[id]/prompt-md endpoint
- Built PromptMdViewer client component using react-markdown + remark-gfm + gray-matter
- Frontmatter parsed and displayed as badge chips above Markdown body
- Code blocks rendered with syntax-aware styling
- Empty state with link to prompt editor when no PROMPT.md configured
- Added PROMPT.md section to project workspace page (between Provider Status and IaC sections)
- Files changed:
  - src/lib/models/project.ts (updated - added promptMd field)
  - src/app/api/projects/[id]/prompt-md/route.ts (new)
  - src/components/prompt-md-viewer.tsx (new)
  - src/app/projects/[id]/page.tsx (updated - added PROMPT.md section)
  - ralph-orchestrator/package.json (updated - added react-markdown, remark-gfm, gray-matter)
  - prd.json (updated - US-25 passes: true)
- **Learnings for future iterations:**
  - react-markdown + remark-gfm for GFM rendering; gray-matter for frontmatter parsing
  - Frontmatter displayed as badge chips (key: value) above the rendered Markdown body
  - PromptMdViewer is a client component due to useMemo; receives content as prop from server component
  - Workspace page section order: Provider Status > PROMPT.md > Infrastructure as Code
---

## 2026-01-29 - US-26
- Implemented PROMPT.md editor with split pane (Markdown editor + live preview)
- Frontmatter editable via form fields (title, agent, iterations, provider + any existing keys)
- Body editable as raw Markdown using @uiw/react-md-editor with syntax highlighting
- Added PUT /api/projects/[id]/prompt-md endpoint for saving
- Created /projects/[id]/prompt page with PromptMdEditor component
- Assembled frontmatter + body into full PROMPT.md content on save
- Files changed:
  - src/components/prompt-md-editor.tsx (new)
  - src/app/api/projects/[id]/prompt-md/route.ts (updated - added PUT handler)
  - src/app/projects/[id]/prompt/page.tsx (new)
  - ralph-orchestrator/package.json (updated - added @uiw/react-md-editor, @uiw/react-markdown-preview)
  - prd.json (updated - US-26 passes: true)
- **Learnings for future iterations:**
  - @uiw/react-md-editor must use dynamic import with ssr: false (depends on browser APIs)
  - gray-matter `matter(content)` returns { data, content } — data is frontmatter object, content is body
  - Frontmatter reassembled via simple YAML format (key: value lines) wrapped in --- delimiters
  - Prompt editor page at /projects/[id]/prompt — linked from PromptMdViewer empty state
  - data-color-mode="light" attribute needed on MDEditor container for proper theming
---

## 2026-01-29 - US-27
- Implemented Reset PROMPT.md to default template with confirmation dialog
- Created src/lib/default-prompt-template.ts with generateDefaultPromptMd() function
- Added DELETE /api/projects/[id]/prompt-md endpoint that generates default template preserving repo URL and branch
- Added "Reset to Default" button with inline confirmation to PromptMdEditor component
- On reset: editor state (frontmatter + body) updated to reflect default content
- Files changed:
  - src/lib/default-prompt-template.ts (new - default template generator)
  - src/app/api/projects/[id]/prompt-md/route.ts (updated - added DELETE handler)
  - src/components/prompt-md-editor.tsx (updated - added reset button with confirmation)
  - prd.json (updated - US-27 passes: true)
- **Learnings for future iterations:**
  - DELETE method on prompt-md route used for "reset to default" semantics (replaces with generated default)
  - Default template preserves project.repo.url and project.repo.branch from existing project config
  - Inline confirmation pattern reused from provider key delete (no modal needed)
  - gray-matter re-parses returned default content to update frontmatter + body state separately
---

## 2026-01-29 - US-28
- Implemented provider selection for runs with dropdown, disabled state for unconfigured providers, and warning when none configured
- Added `defaultProvider` field to Project model
- Extended PATCH /api/projects/[id] to accept and validate `defaultProvider`
- Created RunProviderSelector client component with auto-save on selection change
- Added "Run Provider" section to project workspace page (between Provider Status and PROMPT.md)
- Files changed:
  - src/lib/models/project.ts (updated - added defaultProvider field)
  - src/app/api/projects/[id]/route.ts (updated - PATCH accepts defaultProvider)
  - src/components/run-provider-selector.tsx (new)
  - src/app/projects/[id]/page.tsx (updated - added Run Provider section)
  - prd.json (updated - US-28 passes: true)
- **Learnings for future iterations:**
  - Provider selection auto-saves default on change via PATCH /api/projects/[id]
  - Unconfigured providers shown as disabled options with "(Not Configured)" suffix
  - No providers warning uses yellow border/bg pattern with link to settings
  - Workspace page section order: Provider Status > Run Provider > PROMPT.md > Infrastructure as Code
---

## 2026-01-29 - US-29
- Implemented Plan run with Run model, API endpoints, and workspace UI
- Created Run Mongoose model with type (plan/apply/destroy), status (queued/running/succeeded/failed/canceled), provider, logs, statusHistory
- Created POST /api/projects/[id]/runs endpoint to queue a run (validates provider configured)
- Created GET /api/projects/[id]/runs endpoint to list runs (newest first, max 50, excludes logs)
- Built RunActions client component with Plan button, run list with status badges, error handling
- Added "Runs" section to project workspace page (between Run Provider and PROMPT.md)
- SQS integration stubbed — runs stay in "queued" status until backend infrastructure exists
- Files changed:
  - src/lib/models/run.ts (new - Run model)
  - src/app/api/projects/[id]/runs/route.ts (new - POST create, GET list)
  - src/components/run-actions.tsx (new - Plan button + run list)
  - src/app/projects/[id]/page.tsx (updated - added Runs section)
  - prd.json (updated - US-29 passes: true)
- **Learnings for future iterations:**
  - Run model is separate from Project (not embedded) — allows independent querying and scaling
  - GET /runs excludes logs field via .select("-logs") for performance on list view
  - POST /runs validates provider is configured on the project before allowing run creation
  - Status badges use color coding: queued=blue, running=yellow+pulse, succeeded=green, failed=red, canceled=gray
  - Workspace page section order: Provider Status > Run Provider > Runs > PROMPT.md > Infrastructure as Code
---

## 2026-01-29 - US-30
- Implemented Apply run button with inline confirmation dialog
- Added "Apply" button (orange) next to existing "Plan" button in RunActions component
- Confirmation dialog warns user that real infrastructure will be provisioned
- Uses existing startRun("apply") function and POST /api/projects/[id]/runs endpoint
- SQS integration stubbed — runs stay in "queued" status until backend infrastructure exists
- Files changed:
  - src/components/run-actions.tsx (updated - added Apply button with confirmation)
  - prd.json (updated - US-30 passes: true)
- **Learnings for future iterations:**
  - Apply confirmation uses inline pattern (not modal) consistent with other confirmations in the codebase
  - startRun() already supports all three types (plan/apply/destroy) — just needed UI buttons
  - Destructive run types (apply, destroy) should always have confirmation before triggering
---

## 2026-01-29 - US-31
- Implemented Destroy run button with double confirmation (type project name to confirm)
- Added "Destroy" button (red) next to Plan and Apply buttons in RunActions component
- Double confirmation: first click shows inline panel requiring user to type project name exactly
- Added projectName prop to RunActions, passed from workspace page
- Uses existing startRun("destroy") function and POST /api/projects/[id]/runs endpoint
- SQS integration stubbed — runs stay in "queued" status until backend infrastructure exists
- Files changed:
  - src/components/run-actions.tsx (updated - added Destroy button with double confirmation)
  - src/app/projects/[id]/page.tsx (updated - passes projectName prop)
  - prd.json (updated - US-31 passes: true)
- **Learnings for future iterations:**
  - Double confirmation pattern: inline panel with text input that must match entity name exactly
  - Destroy confirmation is stricter than Apply (type name vs simple confirm) due to destructive nature
  - startRun() already supported "destroy" type — only needed UI button
---

## 2026-01-29 - US-32
- Implemented run detail view with status history timeline and real-time polling
- Created GET /api/projects/[id]/runs/[runId] endpoint for single run retrieval
- Built RunDetailView client component with status badge, timeline, and 5s polling for active runs
- Created /projects/[id]/runs/[runId] page with back navigation and run metadata
- Made run list items clickable (Link) to navigate to run detail
- Added 5s polling to RunActions for auto-refresh when active runs exist
- Files changed:
  - src/app/api/projects/[id]/runs/[runId]/route.ts (new)
  - src/app/projects/[id]/runs/[runId]/page.tsx (new)
  - src/components/run-detail-view.tsx (new)
  - src/components/run-actions.tsx (updated - clickable runs, polling)
  - prd.json (updated - US-32 passes: true)
- **Learnings for future iterations:**
  - Run detail API at /api/projects/[id]/runs/[runId] — returns full run including logs and statusHistory
  - Polling pattern: useEffect with setInterval(fetchFn, 5000) gated by isActive check, cleanup on unmount
  - Status timeline uses vertical line + colored dots pattern for visual status progression
  - Run list items are Links for navigation; run detail page is a server component wrapping client RunDetailView
---

## 2026-01-29 - US-33
- Implemented run log viewer in RunDetailView component
- Log viewer with scrollable container, auto-scroll on new logs, and 5s polling for active runs
- Timestamped entries parsed from "[ISO timestamp] message" format
- Error lines highlighted in red using regex pattern matching (error, failed, exception, panic, fatal)
- Download as .txt file via Blob URL
- Empty state shows "Waiting for log output..." for active runs
- Files changed:
  - src/components/run-detail-view.tsx (updated - added log viewer, download, error highlighting)
  - src/app/projects/[id]/runs/[runId]/page.tsx (updated - passes logs in initialRun)
  - prd.json (updated - US-33 passes: true)
- **Learnings for future iterations:**
  - Log lines can be plain text or timestamped with "[ISO]" prefix — parseLogLine handles both
  - Error detection uses regex patterns for common error keywords (ERROR, failed, exception, panic, fatal)
  - Auto-scroll uses ref + scrollIntoView, disabled when user scrolls up (handleLogScroll checks distance from bottom)
  - Download uses Blob + createObjectURL pattern for client-side file generation
---

## 2026-01-29 - US-34
- Implemented cancel running job functionality
- Created POST /api/projects/[id]/runs/[runId]/cancel endpoint that validates run is queued/running before canceling
- Added Cancel button to RunDetailView (visible next to status badge for active runs)
- Added Cancel button to RunActions run list items (inline, prevents Link navigation via stopPropagation)
- Status transitions to "canceled" with statusHistory entry and log message
- SQS/ECS abort signal stubbed — runs canceled in DB immediately
- Files changed:
  - src/app/api/projects/[id]/runs/[runId]/cancel/route.ts (new)
  - src/components/run-detail-view.tsx (updated - added Cancel button + handler)
  - src/components/run-actions.tsx (updated - added Cancel button per active run in list)
  - prd.json (updated - US-34 passes: true)
- **Learnings for future iterations:**
  - Cancel endpoint is a separate route at /runs/[runId]/cancel (POST) — keeps concerns separated from GET
  - Cancel button in run list uses e.preventDefault() + e.stopPropagation() to prevent Link navigation
  - Only queued/running runs can be canceled — API returns 400 for terminal states
  - Cancel log entry uses ISO timestamp format consistent with other log entries
---

## 2026-01-29 - US-35
- Implemented re-run functionality for completed/failed/canceled runs
- Added "Re-run" button to RunActions run list items (terminal states only)
- Added "Re-run" button to RunDetailView next to status badge for terminal runs
- Re-run creates a new run with the same type and provider via existing POST /api/projects/[id]/runs
- In run detail, re-run navigates to the new run's detail page
- In run list, re-run refreshes the list to show the new run
- Files changed:
  - src/components/run-actions.tsx (updated - added rerunRun function, Re-run button per terminal run)
  - src/components/run-detail-view.tsx (updated - added handleRerun function, Re-run button for terminal runs)
  - prd.json (updated - US-35 passes: true)
- **Learnings for future iterations:**
  - Re-run reuses existing POST /runs endpoint — no new API route needed
  - Terminal states for re-run eligibility: succeeded, failed, canceled
  - Run detail re-run uses window.location.href for full page navigation to new run
  - Run list re-run uses e.preventDefault() + e.stopPropagation() pattern from cancel button
---

## 2026-01-29 - US-36
- Implemented email-driven Ralph loop kickoff on run creation
- Added threadId and emailSubject fields to Run model
- Created src/lib/ralph-email.ts with sendRalphEmail() utility (stubbed — logs and generates thread ID)
- Updated POST /api/projects/[id]/runs to generate email from PROMPT.md and send to agent endpoint
- Thread ID and email subject stored on run record after successful send
- Email failures logged as warnings but don't block run creation
- Updated RunActions to show truncated thread ID in run list items
- Updated RunDetailView to show email thread info section (subject + thread ID)
- Files changed:
  - src/lib/models/run.ts (updated - added threadId, emailSubject fields)
  - src/lib/ralph-email.ts (new - email sending utility)
  - src/app/api/projects/[id]/runs/route.ts (updated - sends email on run creation)
  - src/components/run-actions.tsx (updated - shows thread ID in run list)
  - src/components/run-detail-view.tsx (updated - shows email thread info section)
  - prd.json (updated - US-36 passes: true)
- **Learnings for future iterations:**
  - sendRalphEmail() is stubbed with console.log — replace with SES/SendGrid in production
  - Thread ID generated via crypto.randomUUID() (Node built-in, no uuid package needed)
  - Email failure is non-fatal — run still creates, warning logged
  - Email content comes from project.promptMd field (current PROMPT.md editor content)
  - Thread info displayed in both run list (truncated) and run detail view (full)
---

## 2026-01-29 - US-37
- Implemented email thread view with chronological message display in run detail
- Added IEmailMessage interface and emailMessages array to Run model (messageId, direction, subject, body, timestamp)
- Updated POST /api/projects/[id]/runs to store initial outbound email as first message in emailMessages array
- Enhanced RunDetailView Email Thread section with chronological message list
- Each message shows direction badge (Sent/Received), timestamp, subject, and collapsible body
- Messages sorted chronologically; existing thread metadata (subject, thread ID) preserved above messages
- Files changed:
  - src/lib/models/run.ts (updated - added IEmailMessage, emailMessages field)
  - src/app/api/projects/[id]/runs/route.ts (updated - stores outbound email message)
  - src/components/run-detail-view.tsx (updated - chronological message display)
  - prd.json (updated - US-37 passes: true)
- **Learnings for future iterations:**
  - emailMessages array on Run model tracks individual messages in a thread (outbound + inbound)
  - Direction badge pattern: outbound=blue "Sent", inbound=green "Received"
  - Message body uses collapsible `<details>` element to avoid cluttering the thread view
  - Existing run detail API already returns emailMessages — no separate thread endpoint needed
---

## 2026-01-29 - US-38
- Implemented inbound webhook endpoint for Ralph agent email responses
- Created POST /api/webhooks/ralph-inbound endpoint that captures inbound emails
- Webhook looks up run by threadId or runId, appends inbound email to emailMessages array
- Inbound email body content appended to run logs with [RALPH] prefix for display
- Webhook authenticated via optional WEBHOOK_SECRET env var (x-webhook-secret header)
- Added WEBHOOK_SECRET to .env.example
- Existing RunDetailView already displays inbound emails via emailMessages (direction: "inbound" → green "Received" badge)
- Existing log viewer already renders inbound content via polling
- Files changed:
  - src/app/api/webhooks/ralph-inbound/route.ts (new - inbound webhook endpoint)
  - ralph-orchestrator/.env.example (updated - added WEBHOOK_SECRET)
  - prd.json (updated - US-38 passes: true)
- **Learnings for future iterations:**
  - Webhook endpoints live at /api/webhooks/{name} — no auth session needed, use shared secret
  - Inbound emails appended to both emailMessages (structured) and logs (line-by-line with [RALPH] prefix)
  - Run lookup supports both threadId and runId for flexibility
  - WEBHOOK_SECRET is optional — if not set, endpoint is open (for development)
---

## 2026-01-29 - US-39
- Implemented email failure detection and automatic run status transition
- Added `failureReason` field to Run model for storing extracted error reasons
- Updated inbound webhook to detect error emails via: explicit `isError` flag, subject/body pattern matching
- Error patterns matched: error, failed, failure, fatal, exception, panic, abort (case-insensitive)
- Run status auto-transitions to "failed" when error email detected (only for queued/running runs)
- Failure reason extracted from subject line or first non-empty body line (max 500 chars)
- Added failure reason display in RunDetailView (red banner below status badge)
- failureReason included in run detail polling for real-time updates
- Files changed:
  - src/lib/models/run.ts (updated - added failureReason field)
  - src/app/api/webhooks/ralph-inbound/route.ts (updated - error detection + status transition)
  - src/components/run-detail-view.tsx (updated - failureReason display + fetch)
  - prd.json (updated - US-39 passes: true)
- **Learnings for future iterations:**
  - Webhook payload supports explicit `isError` boolean flag for programmatic error reporting
  - Error detection also uses regex pattern matching on subject and first 500 chars of body
  - Only queued/running runs transition to failed — terminal runs are not affected
  - failureReason capped at 500 chars to prevent oversized UI display
---

## 2026-01-29 - US-40
- Implemented active agent session indicator in project header
- Created GET /api/projects/[id]/agent-session endpoint that checks for queued/running runs
- Returns session info: run type, provider, uptime, iteration number (total run count)
- Built ActiveAgentIndicator client component with animated green dot, uptime counter, and session metadata
- 5s polling for real-time updates; local 1s tick for smooth uptime display
- Indicator hidden when no active session (returns null)
- Files changed:
  - src/app/api/projects/[id]/agent-session/route.ts (new)
  - src/components/active-agent-indicator.tsx (new)
  - src/app/projects/[id]/page.tsx (updated - added ActiveAgentIndicator to header)
  - prd.json (updated - US-40 passes: true)
- **Learnings for future iterations:**
  - Active session = any run with status queued or running for the project
  - Agent session endpoint is read-only GET at /api/projects/[id]/agent-session
  - Uptime calculated from run.createdAt, ticked locally between polls for smooth display
  - Iteration number is total run count for the project (approximation)
---

## 2026-01-29 - US-41
- Implemented auto spin-down after idle timeout for agent sessions
- Added `idleTimeoutMinutes` field to Project model (default: 15, range: 5-60)
- Extended PATCH /api/projects/[id] to accept and validate `idleTimeoutMinutes`
- Updated GET /api/projects/[id]/agent-session to detect idle sessions and auto-cancel runs
- Idle detection uses last activity timestamp (run updatedAt, last email, last status change)
- Auto-canceled runs get log entry and failureReason explaining idle timeout
- Created IdleTimeoutForm client component with range slider (5-60 min, step 5)
- Added "Idle Timeout" section to project settings page (between IaC Template and Danger Zone)
- Updated ActiveAgentIndicator to show "Scaled Down" notice when idle timeout triggers
- Files changed:
  - src/lib/models/project.ts (updated - added idleTimeoutMinutes field)
  - src/app/api/projects/[id]/route.ts (updated - PATCH accepts idleTimeoutMinutes)
  - src/app/api/projects/[id]/agent-session/route.ts (updated - idle detection + auto spin-down)
  - src/components/active-agent-indicator.tsx (updated - scaled down notice)
  - src/components/idle-timeout-form.tsx (new - slider form)
  - src/app/projects/[id]/settings/page.tsx (updated - added Idle Timeout section)
  - prd.json (updated - US-41 passes: true)
- **Learnings for future iterations:**
  - Idle detection uses max of: run.updatedAt, last emailMessage timestamp, last statusHistory timestamp
  - Auto spin-down cancels the run via agent-session GET endpoint (checked on each poll)
  - CloudWatch integration is stubbed — idle check is done application-side for now
  - IdleTimeoutForm uses range slider with step=5 for intuitive selection
  - Settings page section order: ... > IaC Template > Idle Timeout > Danger Zone
---
